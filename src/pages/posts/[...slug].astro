---
import { render } from "astro:content";
import { getAllPosts } from "@/data/post";
import PostLayout from "@/layouts/BlogPost.astro";
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";

// 保留原有路由，方便兼容旧链接
export const getStaticPaths = (async () => {
	const blogEntries = await getAllPosts();
	
	return blogEntries.flatMap((post) => {
		// 提取文章 id 作为 slug
		const slug = post.id;
		const paths = [];
		
		// 标准路径 - 不带后缀
		paths.push({
			params: { slug },
			props: { post }
		});
		
		// 对于旧文章，额外创建带.html后缀的路径
		if (post.data.publishDate < new Date("2025-02-28")) {
			paths.push({
				params: { slug: `${slug}.html` },
				props: { post }
			});
		}
		
		return paths;
	});
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { post } = Astro.props;
const { Content } = await render(post);
---

<PostLayout post={post}>
	<Content />
</PostLayout>